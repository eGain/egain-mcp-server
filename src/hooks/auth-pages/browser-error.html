<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Browser Compatibility Issue - eGain MCP</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: "Open Sans", "Segoe UI", "SegoeUI", "Helvetica Neue", Helvetica, Arial, sans-serif !important;
      background: #fef1fd;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }
    
    .container {
      background: white;
      border-radius: 16px;
      box-shadow: 0px 0px 30px 0px rgba(0, 0, 0, 0.12);
      max-width: 600px;
      width: 100%;
      padding: 32px;
    }
    
    .warning-icon {
      font-size: 64px;
      margin-bottom: 20px;
      text-align: center;
    }
    
    h1 {
      color: #e74c3c;
      font-size: 28px;
      margin-bottom: 20px;
      font-weight: 600;
      text-align: center;
    }
    
    .error-details {
      background: #fff0f6;
      border-left: 4px solid #d946a6;
      padding: 20px;
      margin: 20px 0;
      border-radius: 4px;
    }
    
    .error-details strong {
      color: #a21361;
      display: block;
      margin-bottom: 12px;
      font-size: 16px;
    }
    
    .error-details p {
      color: #a21361;
      font-size: 14px;
      line-height: 1.6;
      margin-bottom: 12px;
    }
    
    .solution {
      background: #f0f9ff;
      border-left: 4px solid #3b82f6;
      padding: 20px;
      margin: 20px 0;
      border-radius: 4px;
    }
    
    .solution strong {
      color: #1e40af;
      display: block;
      margin-bottom: 12px;
      font-size: 16px;
    }
    
    .solution p {
      color: #1e40af;
      font-size: 14px;
      line-height: 1.6;
      margin-bottom: 12px;
    }
    
    .solution ol {
      color: #1e40af;
      font-size: 14px;
      line-height: 1.8;
      margin-left: 20px;
      margin-top: 8px;
    }
    
    .solution ul {
      color: #1e40af;
      font-size: 14px;
      line-height: 1.8;
      margin-left: 20px;
      margin-top: 8px;
    }
    
    .solution code {
      background: rgba(59, 130, 246, 0.1);
      padding: 2px 6px;
      border-radius: 3px;
      font-family: 'Monaco', 'Courier New', monospace;
      font-size: 13px;
    }
    
    .button-group {
      display: flex;
      gap: 10px;
      margin-top: 30px;
      justify-content: center;
    }
    
    button {
      padding: 12px 24px;
      border: 2px solid transparent;
      border-radius: 8px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #b91d8f 0%, #7a1460 100%);
      color: white;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(185, 29, 143, 0.4);
    }
    
    .btn-secondary {
      background: #f6f8fa;
      color: #666;
      border: 2px solid #e1e4e8;
    }
    
    .btn-secondary:hover {
      background: #e1e4e8;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="warning-icon">⚠️</div>
    <h1 id="pageTitle">Browser Compatibility Issue</h1>
    
    <div class="error-details">
      <strong>What happened?</strong>
      <p id="errorMessage">We're having trouble with browser compatibility. This prevents authentication from completing.</p>
    </div>
    
    <!-- Safari Not Supported -->
    <div class="solution" id="safariSolution" style="display: none;">
      <strong>Safari Not Supported:</strong>
      <p style="margin-bottom: 12px;">
        Safari doesn't support private browsing mode via command line, which is required to protect your OAuth credentials from being cached or leaked. <strong>Safari cannot be used for authentication with this MCP server.</strong>
      </p>
      <ol>
        <li><strong>Please use Chrome, Edge, Brave, Opera, or Vivaldi instead</strong></li>
        <li><strong>Close this Safari window</strong></li>
        <li><strong>Reattempt query/authentication</strong></li>
      </ol>
      <p style="margin-top: 12px; font-size: 13px; color: #666;">
        <strong>Why?</strong> We prioritize your security over convenience. Private browsing mode is required to protect your OAuth credentials, and Safari doesn't support this via command line.
      </p>
    </div>
    
    <!-- Firefox Not Supported -->
    <div class="solution" id="firefoxSolution" style="display: none;">
      <strong>Firefox Not Supported:</strong>
      <p style="margin-bottom: 12px;">
        Firefox does not support AppleScript automation for reading page URLs, which is required to detect when authentication completes. <strong>Firefox cannot be used for authentication with this MCP server.</strong>
      </p>
      <ol>
        <li><strong>Please use Chrome, Edge, Brave, Opera, or Vivaldi instead</strong></li>
        <li><strong>Close this Firefox window</strong></li>
        <li><strong>Reattempt query/authentication</strong></li>
      </ol>
      <p style="margin-top: 12px; font-size: 13px; color: #666;">
        <strong>Why?</strong> The OAuth redirect goes to an external URL (not localhost). The MCP server needs to monitor the browser URL to detect when the authorization code appears. Firefox doesn't support this automation, so authentication cannot complete.
      </p>
    </div>
    
    <!-- Chrome about:blank Issue -->
    <div class="solution" id="chromeSolution" style="display: none;">
      <strong>Solution for Chrome:</strong>
      <ol>
        <li><strong>Fully quit Chrome</strong> (not just close windows):
          <ul>
            <li>macOS: Chrome menu → Quit Chrome, or press <code>Cmd+Q</code></li>
            <li>Windows: Right-click Chrome in taskbar → Close window, or press <code>Alt+F4</code></li>
          </ul>
        </li>
        <li>Wait a few seconds for Chrome to fully close</li>
        <li>Reopen Chrome</li>
        <li>Click "Try Again" below to restart authentication</li>
      </ol>
      <p style="margin-top: 12px; font-size: 13px; color: #666;">
        <strong>Why?</strong> Chrome sometimes enters a state where it reports "about:blank" instead of the actual page URL. Restarting Chrome resolves this.
      </p>
    </div>
    
    <!-- Other Browser Monitoring Errors -->
    <div class="solution" id="monitoringSolution" style="display: none;">
      <strong>Browser Monitoring Issue:</strong>
      <p style="margin-bottom: 12px;">
        We cannot read the current page URL from your browser. This is usually due to missing macOS Automation permissions.
      </p>
      <ol>
        <li><strong>Check macOS Automation permissions:</strong>
          <ul>
            <li>Go to System Settings → Privacy & Security → Automation</li>
            <li>Find your MCP client (Claude Desktop, Cursor, Terminal, etc.)</li>
            <li>Ensure your browser is enabled for automation</li>
          </ul>
        </li>
        <li>If your browser is not listed, try triggering authentication once to prompt macOS to ask for permission</li>
        <li>Click "Try Again" below to restart authentication</li>
      </ol>
      <p style="margin-top: 12px; font-size: 13px; color: #666;">
        <strong>Why?</strong> Browser automation permissions are required to allow scripts to read the current page URL and detect when authentication completes.
      </p>
    </div>
    
    <div class="button-group">
      <button class="btn-secondary" onclick="window.close()">Close</button>
      <button class="btn-primary" onclick="retryAuthentication()">Try Again</button>
    </div>
  </div>
  
  <script>
    // Detect browser and error type, show appropriate solution
    const userAgent = navigator.userAgent.toLowerCase();
    const errorType = new URLSearchParams(window.location.search).get('type') || 'unknown';
    const browserName = new URLSearchParams(window.location.search).get('browser') || '';
    const browserLower = browserName.toLowerCase();
    
    // Determine which solution to show
    if (browserLower.includes('safari') || errorType === 'notsupported') {
      // Safari not supported
      document.getElementById('pageTitle').textContent = 'Safari Not Supported';
      document.getElementById('safariSolution').style.display = 'block';
      document.getElementById('errorMessage').textContent = 
        'Safari doesn\'t support private browsing mode via command line, which is required to protect your OAuth credentials. Safari cannot be used for authentication.';
    } else if (browserLower.includes('firefox') || errorType === 'monitoring') {
      // Firefox not supported
      document.getElementById('pageTitle').textContent = 'Firefox Not Supported';
      document.getElementById('firefoxSolution').style.display = 'block';
      document.getElementById('errorMessage').textContent = 
        'Firefox does not support AppleScript automation for reading page URLs, which is required to detect when authentication completes. Firefox cannot be used for authentication.';
    } else if (errorType === 'aboutblank' || (browserLower.includes('chrome') && errorType !== 'monitoring')) {
      // Chrome about:blank issue
      document.getElementById('pageTitle').textContent = 'Chrome Browser Issue';
      document.getElementById('chromeSolution').style.display = 'block';
      document.getElementById('errorMessage').textContent = 
        'Chrome is reporting "about:blank" instead of the actual page URL. This prevents us from detecting when authentication completes.';
    } else {
      // Other monitoring errors (permissions, etc.)
      document.getElementById('pageTitle').textContent = 'Browser Monitoring Issue';
      document.getElementById('monitoringSolution').style.display = 'block';
      document.getElementById('errorMessage').textContent = 
        'We cannot read the current page URL from your browser. This is usually due to missing macOS Automation permissions or a browser compatibility issue.';
    }
    
    function retryAuthentication() {
      // Redirect back to config page to restart authentication
      window.location.href = '/config';
    }
  </script>
</body>
</html>
